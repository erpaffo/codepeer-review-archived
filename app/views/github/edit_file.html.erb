<h1>Editing File: <%= @file_path %></h1>

<% if @file_content.blank? %>
  <p>File content is missing.</p>
<% end %>

<div class="container">
  <div class="sidebar left" id="sidebar">
    <button id="toggle-button">Toggle Sidebar</button>
    <h2>Files</h2>
    <ul id="file-tree">
      <% if @contents.present? %>
        <% @contents.each do |item| %>
          <li>
            <% if item.type == 'dir' %>
              <%= link_to item.name, edit_repository_file_path(@repository, item.path) %>
            <% else %>
              <%= link_to item.name, edit_repository_file_path(@repository, item.path) %>
            <% end %>
          </li>
        <% end %>
      <% else %>
        <li>No files found.</li>
      <% end %>
    </ul>
    <div class="resizer" id="resizer-left"></div>
  </div>
  <div class="main-content" id="main-content">
    <div class="top-bar">
      <%= form_with(url: update_repository_file_path(@repository, @file_path), method: :patch, local: true) do %>
        <button id="save-file-button" type="submit">Save File</button>
        <textarea name="content" hidden></textarea>
      <% end %>
      <button id="run-code-button" class="run-code">Run Code</button>
      <button id="manage-packages-button" class="manage-packages">Manage Packages</button>
    </div>
    <textarea id="file-content" hidden data-file-path="<%= @file_path %>" data-repository="<%= @repository %>"><%= @file_content %></textarea>
    <div id="editor-container" style="height: calc(100vh - 200px); width: 100%;">
      <div id="editor" style="height: 100%; width: 100%;"></div>
    </div>
    <div id="output-container" class="output-container">
      <h2>Output</h2>
      <pre id="output" class="output"></pre>
    </div>
    <div class="resizer" id="resizer-editor"></div>
  </div>
  <div class="sidebar right" id="sidebar-right">
    <h2>Tools</h2>
    <div>Placeholder for tools</div>
  </div>
</div>

<div id="package-manager" class="modal">
  <div class="modal-content">
    <span class="close-button">&times;</span>
    <h2>Manage Packages</h2>
    <% if @available_packages.any? %>
      <ul id="package-list">
        <% @available_packages.each do |package| %>
          <li>
            <label>
              <input type="checkbox" name="packages[]" value="<%= package %>">
              <%= package %>
            </label>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p>No packages available.</p>
    <% end %>
    <button id="save-packages-button">Save Packages</button>
  </div>
</div>
